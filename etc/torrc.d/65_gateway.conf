## Do not edit this file!
## Please create and add modifications to the following file instead:
## /usr/local/etc/torrc.d/50_user.conf

## Copyright (C) 2012 - 2021 ENCRYPTED SUPPORT LP <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

## Please use "/usr/local/etc/torrc.d/50_user.conf" for your custom
## configuration, which will override the defaults found here.
## When this package is updated, this file may be overwritten.

#### meta start
#### project Whonix
#### category tor and networking
#### gateway_only yes
#### description
## Tor settings for Gateway: `ClientOnionAuthDir`, `SocksPort`s, `TransPort`,
## `DnsPort`, `HTTPTunnelPort`s and stream isolation settings.
#### meta end

########################
# Tor Control Protocol #
########################

## Required for onion-grater.
## See /usr/lib/onion-grater for the comment.
## See also upstream bug report:
## No Control Socket when DisableNetwork and User options are set
## https://gitlab.torproject.org/tpo/core/tor/-/issues/25173
ControlPort 9052
## Oct 15 14:04:17.408 [warn] ControlPort is open, but no authentication method has been configured.  This means that any program on your computer can reconfigure your Tor.  That's bad!  You should upgrade your Tor controller as soon as possible.
CookieAuthentication 1

###################################
# Authenticated Onion v3 Services #
###################################

## anon-gw-anonymizer-config.service /
## /usr/libexec/anon-gw-anonymizer-config/make-sure-torrc-exist
## creates folder /var/lib/tor/authdir
ClientOnionAuthDir /var/lib/tor/authdir

###########################
# Gateway Trans/Dns-Port #
###########################

# TransPort and DnsPort are not enabled in gateway firewall by default.
##
# (comment mirrored from /usr/bin/whonix_firewall)
# Transparent Proxy Ports for Whonix-Gateway
# TRANS_PORT_GATEWAY="9041"
# DNS_PORT_GATEWAY="5400"
TransPort 127.0.0.1:9041
DnsPort 127.0.0.1:5400

#######################
# Gateway SocksPorts #
#######################

# Developer comment:
##
# We actually do not need all of them,
# but they do not hurt anyway and
# it keeps the setup more generic,
# with less exceptions.
##
# Comments why we (not) use IsolateDestAddr and/or IsolateDestPort
# are the same as in section Workstation SocksPorts.

## /usr/share/tor/tor-service-defaults-torrc contains 'SocksPort unix:/run/tor/socks WorldWritable' too.
## Have to add here too. Syntax is non-intuitive.
## https://www.whonix.org/wiki/Tor#Additional_SocksPorts
## https://trac.torproject.org/projects/tor/ticket/15261
SocksPort unix:/run/tor/socks IPv6Traffic WorldWritable

SocksPort 127.0.0.1:9050 IPv6Traffic

SocksPort 127.0.0.1:9100 IPv6Traffic
SocksPort 127.0.0.1:9101 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9102 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9103 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9104 IPv6Traffic
SocksPort 127.0.0.1:9105 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9106 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9107 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9108 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9109 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9110 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9111 IPv6Traffic
#SocksPort 127.0.0.1:9112 IPv6Traffic
#SocksPort 127.0.0.1:9113 IPv6Traffic
SocksPort 127.0.0.1:9114 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9115 IPv6Traffic IsolateDestAddr IsolateDestPort
#SocksPort 127.0.0.1:9116 IPv6Traffic
SocksPort 127.0.0.1:9117 IPv6Traffic IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9118 IPv6Traffic IsolateDestAddr IsolateDestPort
#SocksPort 127.0.0.1:9119 IPv6Traffic
#SocksPort 127.0.0.1:9120 IPv6Traffic
#SocksPort 127.0.0.1:9121 IPv6Traffic
SocksPort 127.0.0.1:9122 IPv6Traffic
SocksPort 127.0.0.1:9123 IPv6Traffic
SocksPort 127.0.0.1:9124 IPv6Traffic
SocksPort 127.0.0.1:9125 IPv6Traffic
SocksPort 127.0.0.1:9150 IPv6Traffic PreferIPv6 KeepAliveIsolateSOCKSAuth

##########################
# Gateway HTTPTunnelPort #
##########################

# without IsolateDestAddr
# without IsolateDestPort
HTTPTunnelPort 127.0.0.1:9190
HTTPTunnelPort 127.0.0.1:9191
HTTPTunnelPort 127.0.0.1:9192
HTTPTunnelPort 127.0.0.1:9193
HTTPTunnelPort 127.0.0.1:9194
HTTPTunnelPort 127.0.0.1:9195
HTTPTunnelPort 127.0.0.1:9196
HTTPTunnelPort 127.0.0.1:9197
HTTPTunnelPort 127.0.0.1:9198
HTTPTunnelPort 127.0.0.1:9199

# with IsolateDestAddr
# without IsolateDestPort
HTTPTunnelPort 127.0.0.1:9200 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9201 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9202 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9203 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9204 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9205 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9206 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9207 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9208 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9209 IsolateDestAddr

# without IsolateDestAddr
# with IsolateDestPort
HTTPTunnelPort 127.0.0.1:9210 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9211 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9212 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9213 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9214 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9215 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9216 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9217 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9218 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9219 IsolateDestPort

# with IsolateDestAddr
# with IsolateDestPort
HTTPTunnelPort 127.0.0.1:9220 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9221 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9222 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9223 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9224 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9225 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9226 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9227 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9228 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9229 IsolateDestAddr IsolateDestPort
