#!/bin/bash

## Copyright (C) 2022 ENCRYPTED SUPPORT LP <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

#set -x

set -e
shopt -s nullglob

error_handler() {
   local exit_code="$?"
   echo "ERROR: exit_code: $exit_code | BASH_COMMAND: $BASH_COMMAND"
   exit 1
}

trap error_handler ERR

SCRIPTNAME="$(basename "$BASH_SOURCE")"

if test -n "${1}" && [ "${1}" != "show" ]; then
  echo "ERROR: only accepted argument is 'show'"
  exit 1
fi

show="$1"

for profile in \
  /etc/onion-grater-merger.d/*.yml \
  /usr/local/etc/onion-grater-merger.d/*.yml
do
  [ "${profile}" = "*" ] && continue
  if [ "$show" = "show" ]; then
    echo "===================================================================="
    echo "BEGIN PROFILE: ${profile}"
    echo "--------------------------------------------------------------------"
    cat "${profile}"
    echo "--------------------------------------------------------------------"
    echo "END PROFILE: ${profile}"
    echo "===================================================================="
  else
    echo "${profile}"
  fi
done


